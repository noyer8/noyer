<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NOYER ‚Äî V√©rification d‚Äô√©ligibilit√©</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0a0a; --panel:#111; --muted:#bcbcbc; --soft:#8a8a8a;
      --accent:#26d19a; --accent-2:#1ea97b; --danger:#ff5757;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      background:var(--bg); color:#e5e5e5; font-family:'JetBrains Mono', monospace;
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .wrap{width:100%; max-width:860px}
    .title{text-align:center; margin-bottom:28px}
    .title h1{color:var(--accent); letter-spacing:4px; font-size:2.6rem; text-transform:uppercase}
    .subtitle{color:var(--muted); margin-top:8px; font-size:1rem}
    .card{
      background:var(--panel); border:1px solid #1b1b1b; border-radius:14px;
      padding:24px; box-shadow:0 0 20px rgba(38,209,154,.08);
    }
    .grid{display:grid; grid-template-columns:1fr; gap:16px}
    @media (min-width:820px){ .grid{grid-template-columns:1fr 1fr} }
    label{display:block; color:#dcdcdc; font-size:.92rem; margin-bottom:8px}
    input{
      width:100%; background:#0e0e0e; color:#e9e9e9; border:1px solid #222;
      border-radius:10px; padding:14px 14px; font-size:.98rem; outline:none; transition:border .2s;
    }
    input:focus{border-color:var(--accent)}
    .full{grid-column:1/-1}
    .hint{font-size:.86rem; color:var(--soft); margin-top:12px}
    .warn{grid-column:1/-1; font-size:.9rem; background:#140f0f; border:1px dashed #2a2a2a; color:#c7c7c7; padding:12px 14px; border-radius:10px}
    .btn{
      margin-top:18px; background:var(--accent); color:#0a0a0a; border:0; border-radius:10px;
      padding:14px 22px; font-weight:700; cursor:pointer; transition:transform .15s, box-shadow .3s, background .2s;
      box-shadow:0 0 16px rgba(38,209,154,.35);
    }
    .btn:hover{background:var(--accent-2); transform:translateY(-1px)}
    .btn[disabled]{opacity:.6; cursor:not-allowed; transform:none; box-shadow:none}
    .status{margin-top:14px; min-height:22px; font-size:.95rem}
    .ok{color:var(--accent)}
    .err{color:var(--danger)}
    .next{display:none; margin-left:12px}
    footer{position:fixed; bottom:12px; left:0; right:0; text-align:center; color:#6d6d6d; font-size:.85rem}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <h1>NOYER</h1>
      <p class="subtitle">V√©rifiez si votre site est compatible avant de continuer.</p>
    </div>

    <div class="card">
      <form id="eligForm" class="grid" autocomplete="on">
        <div class="full">
          <label for="agency">üè¢ Nom de l‚Äôagence</label>
          <input id="agency" name="agency" type="text" placeholder="Ex : Belle Maison Immobilier" required />
        </div>

        <div>
          <label for="listUrl">üóÇÔ∏è URL de la page des biens (liste)</label>
          <input id="listUrl" name="listUrl" type="url" placeholder="https://www.votre-agence.fr/biens" required />
        </div>

        <div>
          <label for="itemUrl">üè∑Ô∏è URL d‚Äôun bien pr√©sent sur cette page</label>
          <input id="itemUrl" name="itemUrl" type="url" placeholder="https://www.votre-agence.fr/biens/maison-123" required />
        </div>

        <div class="warn">‚ö†Ô∏è Ne mettez pas la page d‚Äôaccueil. Il faut la page liste et la page d‚Äôun bien.</div>

        <div class="full">
          <button type="submit" class="btn" id="verifyBtn">V√©rifier</button>
          <a href="questions.html" id="continueBtn" class="btn next">Continuer</a>
          <div id="status" class="status"></div>
        </div>
      </form>
    </div>
  </div>

  <footer>¬© 2025 Noyer ‚Äî Publication Automatique</footer>

  <script>
    const WEBHOOK_URL = 'https://pierre07.app.n8n.cloud/webhook/recieve_url';
    const form = document.getElementById('eligForm');
    const verifyBtn = document.getElementById('verifyBtn');
    const continueBtn = document.getElementById('continueBtn');
    const statusEl = document.getElementById('status');

    function setStatus(msg, cls=''){ statusEl.className = 'status ' + cls; statusEl.textContent = msg; }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const agency = form.agency.value.trim();
      const listUrl = form.listUrl.value.trim();
      const itemUrl = form.itemUrl.value.trim();

      if (!agency || !listUrl || !itemUrl) { setStatus('Veuillez remplir tous les champs.', 'err'); return; }

      verifyBtn.disabled = true;
      setStatus('V√©rification en cours‚Ä¶', '');

      try {
        const payload = { agency, listUrl, itemUrl, source: 'noyer-site' };
        const res = await fetch(WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        const data = await res.json().catch(() => ({}));

        if (!res.ok) throw new Error(data?.reason || 'Erreur serveur');

        if (data.eligible) {
          setStatus('‚úÖ Site √©ligible. Vous pouvez continuer.', 'ok');
          continueBtn.style.display = 'inline-block';
          verifyBtn.style.display = 'none';

          // üîπ Enregistrer les donn√©es dans la m√©moire locale
          localStorage.setItem('noyerAgency', agency);
          localStorage.setItem('noyerListUrl', listUrl);
          localStorage.setItem('noyerItemUrl', itemUrl);

        } else {
          setStatus('‚ùå Non √©ligible : ' + (data.reason || 'site non compatible.'), 'err');
          verifyBtn.disabled = false;
        }
      } catch (err) {
        setStatus('‚ö†Ô∏è V√©rification impossible : ' + err.message, 'err');
        verifyBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
