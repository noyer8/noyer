<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Connexion Meta</title>
</head>
<body>

  <h2>Connexion avec Meta (Facebook / Instagram)</h2>

  <!-- Bouton Login Facebook avec CONFIG_ID -->
  <div 
    class="fb-login-button" 
    login_config_id="4348016772093927"
    onlogin="checkLoginState();"
    data-size="large"
    data-button-type="continue_with"
    data-layout="default"
    data-auto-logout-link="false"
    data-use-continue-as="false">
  </div>

  <!-- SDK Facebook -->
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/en_US/sdk.js">
  </script>

  <script>
    // Initialisation du SDK Facebook
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '2451194691945458',
        cookie     : true,
        xfbml      : true,
        version    : 'v19.0'
      });
    };

    // Fonction appelée après login
    function checkLoginState() {
      FB.getLoginStatus(function(response) {
        console.log("Login Status:", response);

        if (response.status === "connected") {
          // Token temporaire (NE SERT PAS POUR PUBLICATION)
          console.log("FB accessToken:", response.authResponse.accessToken);
        }
      });
    }

    // Si Facebook redirige ici avec ?code=XXXXX
    const urlParams = new URLSearchParams(window.location.search);
    const authCode = urlParams.get("code");

    if (authCode) {
      console.log("CODE REÇU :", authCode);

      // Envoie le code à ton backend pour obtenir un access_token permanent
      fetch("https://noyer-backend-meta.onrender.com/meta/exchange-code", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code: authCode })
      })
      .then(res => res.json())
      .then(data => {
        console.log("Token généré par le backend :", data);
      })
      .catch(err => console.error(err));
    }
  </script>

</body>
</html>
