<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Connexion Meta</title>
</head>
<body>

  <h2>Connexion avec Meta (Facebook / Instagram)</h2>

  <!-- Ton propre bouton -->
  <button onclick="connectMeta()">
    Connexion Meta
  </button>

  <!-- SDK Facebook -->
  <script async defer crossorigin="anonymous"
    src="https://connect.facebook.net/en_US/sdk.js"></script>

  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '2451194691945458',
        cookie     : true,
        xfbml      : false,
        version    : 'v19.0'
      });
    };

    // ðŸ”¥ APPEL OFFICIEL BUSINESS LOGIN
    function connectMeta() {
      FB.login(function(response) {
        console.log("RÃ©ponse login :", response);
      }, {
        login_config_id: "32932249913040230",
        response_type: "code",
        override_default_response_type: true
      });
    }

    // ðŸ”¥ TRAITEMENT SI REDIRIGÃ‰ AVEC ?code=
    const urlParams = new URLSearchParams(window.location.search);
    const authCode = urlParams.get("code");

    if (authCode) {
      console.log("CODE REÃ‡U :", authCode);

      fetch("https://noyer-backend-meta.onrender.com/meta/exchange-code", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code: authCode })
      })
      .then(res => res.json())
      .then(data => {
        console.log("Token gÃ©nÃ©rÃ© par le backend :", data);
      })
      .catch(err => console.error(err));
    }
  </script>

</body>
</html>
